(()=>{"use strict";var e,t,a,r={464:(e,t,a)=>{var r=a(5338),s=a(6540),l=a(7859),i=a(4848);const n=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("directionalLight",{castShadow:!0,position:[1e3,-500,600]}),(0,i.jsx)("directionalLight",{castShadow:!0,color:1118481,position:[-1,-1,-1]}),(0,i.jsx)("directionalLight",{castShadow:!0,color:16777215,position:[0,1,1]}),(0,i.jsx)("directionalLight",{castShadow:!0,color:2236962,position:[1,0,1]}),(0,i.jsx)("directionalLight",{castShadow:!0,color:2236962,position:[-1,0,1]}),(0,i.jsx)("ambientLight",{intensity:.1,color:16777215})]});var o=a(3865),c=a(2402),m=a(920),T=a(9174),g=a(9437);class d{static WOOD="./images/dver.jpg";static WOOD_GREEN="./images/zelderevo.jpg";static GLASS="./images/okno1.jpg";static PUTTY="./images/shpaklevka.jpg";static PUTTY_GREY="./images/sershpak.jpg";static PUTTY_DARK_GREY="./images/TSerShpak.jpg";static PUTTY_BEIGE="./images/bezhshpak.jpg";static ROOFING_FELT="./images/rubiroid.jpg";static METAL="./images/temnmetall.jpg";static SHEET="./images/proff1.jpg";static SHEET_GREEN="./images/zelproff.jpg";static BRICK_RED="./images/kirpich1.jpg";static PAINT_GREEN="./images/zelkraska.jpg";static ASPHALT="./images/asfalt1.jpg";static GRASS="./images/planee.jpg";static GOLD="./images/zoloto.jpg"}let u=function(e){return e.TERRAIN="terrain",e.ROAD="road",e.STAIRS="stairs",e.BASE="base",e.WALL="wall",e.TOWER="tower",e}({});const p=new Map([["terrain",u.TERRAIN],["stairs",u.STAIRS],["walls",u.WALL],["road1",u.ROAD],["road2",u.ROAD],["road3",u.ROAD],["road4",u.ROAD],["belaya",u.TOWER],["borisoglebovskaya",u.TOWER],["chasovaya",u.TOWER],["dmitrievskaya",u.TOWER],["georgievskaya",u.TOWER],["ivanovskaya",u.TOWER],["kladovaya",u.TOWER],["koromislova",u.TOWER],["nikolskaya",u.TOWER],["porohovaya",u.TOWER],["severnaya",u.TOWER],["tainitskaya",u.TOWER],["zachatskaya",u.TOWER]]),E=[-2e3,1e3,0,0,0,0],h=[{name:"arsenal",x:382,z:-730,url:"./models/arsenal.glb",textureUrls:[d.SHEET,d.BRICK_RED,d.PUTTY],angle:-1},{name:"hozkorpus",x:688,z:986,url:"./models/hozkorpus.glb",textureUrls:[d.ROOFING_FELT,d.BRICK_RED],angle:0},{name:"sovet",x:-119,z:-646,url:"./models/sovet.glb",textureUrls:[d.WOOD,d.GLASS,d.GLASS,d.PUTTY,d.GLASS,d.ROOFING_FELT,d.ROOFING_FELT,d.PUTTY,d.PUTTY_GREY,d.PUTTY_GREY,d.PUTTY],angle:0},{name:"garage",x:-336,z:-1380,url:"./models/garage.glb",textureUrls:[d.METAL,d.GLASS,d.PUTTY_GREY,d.PUTTY,d.ROOFING_FELT],angle:0},{name:"kazar",x:729,z:347,url:"./models/kazar.glb",textureUrls:[d.SHEET,d.BRICK_RED,d.BRICK_RED,d.BRICK_RED,d.BRICK_RED],depthY:-2},{name:"services",x:-139,z:-1240,url:"./models/services.glb",textureUrls:[d.PUTTY_GREY,d.PUTTY_GREY,d.SHEET_GREEN,d.WOOD,d.GLASS,d.PUTTY_BEIGE],angle:-1,depthY:0},{name:"vicegub",x:420,z:132,url:"./models/vicegub.glb",textureUrls:[d.PUTTY_GREY,d.PUTTY_GREY,d.SHEET_GREEN,d.PUTTY,d.PUTTY],depthY:0},{name:"hospital",x:420,z:-138,url:"./models/hospital.glb",textureUrls:[d.PUTTY_BEIGE,d.PUTTY,d.PUTTY,d.PUTTY,d.PUTTY,d.PUTTY,d.PUTTY_GREY,d.METAL,d.WOOD,d.WOOD,d.WOOD,d.ROOFING_FELT,d.GLASS,d.GLASS],depthY:0},{name:"kotel",x:-266,z:-1135,url:"./models/kotel.glb",textureUrls:[d.ROOFING_FELT,d.WOOD,d.WOOD,d.GLASS,d.PUTTY_GREY,d.PUTTY],depthY:0},{name:"muzei",x:-291,z:-974,url:"./models/muzei.glb",textureUrls:[d.WOOD,d.GLASS,d.SHEET,d.WOOD,d.METAL,d.METAL,d.PUTTY,d.PUTTY,d.PUTTY,d.PUTTY],depthY:-2},{name:"obkom",x:140,z:0,url:"./models/obkom.glb",textureUrls:[d.GLASS,d.WOOD,d.WOOD,d.GLASS,d.PUTTY,d.PUTTY],depthY:-2},{name:"minin",x:-355,z:131,url:"./models/minin.glb",textureUrls:[d.GLASS,d.PUTTY_DARK_GREY,d.PUTTY_DARK_GREY,d.PUTTY,d.PUTTY,d.PUTTY],depthY:-2},{name:"stella",x:687,z:-158,url:"./models/stella.glb",textureUrls:[d.PUTTY_GREY,d.PUTTY_DARK_GREY,d.PUTTY],depthY:-2},{name:"church",x:-78,z:360,url:"./models/church.glb",textureUrls:[d.METAL,d.WOOD_GREEN,d.PAINT_GREEN,d.PAINT_GREEN,d.PAINT_GREEN,d.PAINT_GREEN,d.PAINT_GREEN,d.PAINT_GREEN,d.PAINT_GREEN,d.PUTTY,d.GLASS,d.PUTTY,d.PUTTY,d.PUTTY,d.PUTTY,d.PUTTY],depthY:0},{name:"prisut",x:231,z:733,url:"./models/prisut.glb",textureUrls:["./images/zoloto.jpg",d.PUTTY,d.SHEET_GREEN,d.PUTTY,d.WOOD,d.PUTTY_GREY],depthY:-1},{name:"ministry",x:387,z:1182,url:"./models/ministry.glb",textureUrls:[d.PUTTY,d.PUTTY_BEIGE,d.PUTTY,d.ROOFING_FELT],depthY:-2},{name:"manezh",x:33,z:1251,url:"./models/manezh.glb",textureUrls:[d.PUTTY_GREY,d.SHEET_GREEN,d.BRICK_RED,d.GOLD,d.GOLD,d.SHEET_GREEN,d.PUTTY,d.BRICK_RED,d.BRICK_RED,d.PUTTY,d.PUTTY]},{name:"financial",x:33,z:1048,url:"./models/financial.glb",textureUrls:[d.PUTTY,d.PUTTY_BEIGE,d.PUTTY,d.PUTTY,d.ROOFING_FELT,d.ROOFING_FELT,d.PUTTY]}],R=[{name:"zachatskaya",title:"Зачатская башня",z:-366,x:-1070,url:"./models/zachatskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:-17},{name:"borisoglebovskaya",title:"Борисоглебовская башня",z:-1019,x:-875,url:"./models/borisoblebovskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.13,angle:6},{name:"georgievskaya",title:"Георгиевская башня",z:-1606,x:-428,url:"./models/georgievskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:-90,depthY:-3},{name:"porohovaya",title:"Пороховая башня",z:-905,x:288,url:"./models/porohovaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11},{name:"dmitrievskaya",z:-459,x:718,url:"./models/dmitrievskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:10,title:"Дмитриеская башня",text:"В память о великом князе Дмитрии Константиновиче и его покровителе Дмитрии Солунском центральную башню Нижегородского кремля назвали Дмитриевской. Опорный пункт защиты Верхнего Посада. Прямоугольная, проезжая башня соединялась каменным арочным мостом с предмостным укреплением — пятиугольной отводной стрельницей в окружении крепостного рва.",image:"./images/dmit-bashnya-min.png"},{name:"kladovaya",title:"Кладовая башня",z:157,x:900,url:"./models/kladovaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:0},{name:"nikolskaya",title:"Никольская башня",z:784,x:1072,url:"./models/nikolskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:10},{name:"koromislova",title:"Коромыслова башня",z:1340,x:900,url:"./models/koromislova.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:10},{name:"tainitskaya",title:"Тайнитская башня",z:1568,x:7,url:"./models/tainitskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:10},{name:"severnaya",title:"Северная башня",z:1247,x:-486,url:"./models/severnaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:0},{name:"chasovaya",title:"Часовая башня",z:1043,x:-459,url:"./models/chasovaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:0,depthY:-3},{name:"ivanovskaya",title:"Ивановская башня",z:720,x:-883,url:"./models/ivanovskaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:12,depthY:-1},{name:"belaya",title:"Белая башня",z:149,x:-1037,url:"./models/belaya.glb",textureUrls:["./images/kirpich1.jpg"],scale:.11,angle:12,depthY:-5}];var x=a(9689);function O(e,t,a){const r=a.children.find((e=>e.name===u.BASE))?.children.find((e=>e.name===u.TERRAIN)),s=new g.Raycaster,l=new g.Vector3(e,0,t),i=[new g.Vector3(0,90*g.MathUtils.DEG2RAD,0),new g.Vector3(0,-90*g.MathUtils.DEG2RAD,0)];let n;r.updateMatrixWorld();for(const e of i){s.set(l,e);const t=s.intersectObject(r);if(t?.length&&t[0].point){n=t[0];break}}return n?.point}var U=a(9644);function b(e){const t=(0,T.z)(e);return t.wrapS=g.MirroredRepeatWrapping,t.wrapT=g.MirroredRepeatWrapping,t.repeat.set(20,20),t.anisotropy=12,t}var Y=a(2656);const P=e=>{let{building:t,onClick:a}=e;const{x:r,z:l,url:n,name:o,textureUrls:c,angle:T,scale:d}=t,{scene:E}=(0,x.z)(),[h,R]=(0,s.useState)(null),P=(0,m.p)(n,!0),j=(0,s.useRef)(null);let _;const v=Object.values(P.nodes).filter((e=>e instanceof g.Mesh)),S=new g.Group;S.add(...v),S.name=o,_=S;const[y,k]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=O(r,l,E)||new g.Vector3(0,0,0),t=(new g.Box3).setFromObject(j.current),a=new g.Vector3,s=new g.Vector3;t.getCenter(a),t.getSize(s);const i=s.x/2,n=s.z/2,o=[new g.Vector3(r-i,e.y,l-n),new g.Vector3(r+i,e.y,l+n),new g.Vector3(r-i,e.y,l+n),new g.Vector3(r+i,e.y,l-n)].map((e=>(O(e.x,e.z,E)||new g.Vector3(0,0,0)).y));R(new g.Vector3(r,Math.min(...o),l))}),[E]);const f={baseMaterial:null,obj:null},G=()=>{f?.obj&&(f.obj.material=f.baseMaterial)};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("group",{name:o,ref:j,position:new g.Vector3(r,h?.y||0,l),"rotation-y":g.MathUtils.DEG2RAD*(T??0),scale:d??1,onClick:e=>a&&a(e,t),onPointerLeave:()=>{G(),k(!1)},onPointerEnter:e=>{if(p.get(t.name)===u.TOWER&&(k(!0),f.obj?.name!==t.name)){G();const t=e.object;f.obj=t,f.baseMaterial=t.material.clone(),t.material=new g.MeshStandardMaterial({color:5197647})}},children:[_?.children?.map(((e,t)=>{const a=b(c[t]);return(0,i.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.geometry,material:new g.MeshPhongMaterial({map:a,side:g.DoubleSide})},e.id)})),y&&(0,i.jsx)(U.E,{children:(0,i.jsx)(Y.A,{title:t.title||t.name,open:!0})})]})})},j=(0,s.memo)(P),_=(0,a(1511).v)((e=>({selectedBuilding:null,cameraParameters:E,setSelectedBuilding:t=>e((()=>({selectedBuilding:t}))),setCameraParameters:t=>e((()=>({cameraParameters:t})))}))),v=()=>{const e=_((e=>e)),t=(t,a)=>{p.get(a.name)===u.TOWER&&(e.setCameraParameters([t.point.x-300,50,t.point.z-100,t.point.x,t.point.y,t.point.z]),e.setSelectedBuilding(a))};return(0,i.jsxs)(i.Fragment,{children:[h.map((e=>(0,i.jsx)(j,{building:e},e.name))),R.map((e=>(0,i.jsx)(j,{building:e,onClick:t},e.name)))]})},S=(0,s.memo)(v),y=()=>{const e=(0,m.p)("./models/base.glb",!0);return e.scene.name="base",e.scene.children.forEach((e=>{let t=(0,T.z)(d.BRICK_RED);switch(p.get(e.name)){case u.TERRAIN:t=b(d.GRASS);break;case u.STAIRS:case u.ROAD:t=(0,T.z)(d.ASPHALT)}t.needsUpdate=!0,e.material=new g.MeshStandardMaterial({map:t,side:g.DoubleSide})})),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("primitive",{dispose:null,object:e.scene}),(0,i.jsx)(S,{})]})},k=(0,s.memo)(y);var f=a(8262),G=a(1653);const A=()=>{const{setSelectedBuilding:e,selectedBuilding:t,setCameraParameters:a}=_(),r=()=>{e(null),a(E)};return(0,i.jsx)(f.A,{title:t?.title||t?.name,open:!!t,onClose:r,onOk:r,onCancel:r,width:500,footer:(0,i.jsx)(G.Ay,{onClick:r,children:"Закрыть"}),children:(0,i.jsxs)("div",{className:"modal__body",children:[t?.image&&(0,i.jsx)("div",{className:"modal__image",children:(0,i.jsx)("img",{src:t.image,alt:t.name})}),t?.text&&(0,i.jsx)("div",{className:"modal__text",children:t.text})]})})},z=(0,s.memo)(A),w=()=>{const e=(0,s.useRef)(),{cameraParameters:t}=_();return(0,s.useEffect)((()=>{e?.current&&e.current.setLookAt(...t,!0)}),[t]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l.Hl,{shadows:"soft",camera:{fov:60,aspect:window.innerWidth/window.innerHeight,near:1,far:1e5,position:new g.Vector3(...E.slice(0,2))},children:[(0,i.jsx)(k,{}),(0,i.jsx)(n,{}),(0,i.jsx)(o.a,{ref:e})]}),(0,i.jsx)(c.a,{}),(0,i.jsx)(z,{})]})};(0,r.H)(document.getElementById("root")).render((0,i.jsx)(w,{}))}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return r[e](a,a.exports,l),a.exports}l.m=r,e=[],l.O=(t,a,r,s)=>{if(!a){var i=1/0;for(m=0;m<e.length;m++){a=e[m][0],r=e[m][1],s=e[m][2];for(var n=!0,o=0;o<a.length;o++)(!1&s||i>=s)&&Object.keys(l.O).every((e=>l.O[e](a[o])))?a.splice(o--,1):(n=!1,s<i&&(i=s));if(n){e.splice(m--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var m=e.length;m>0&&e[m-1][2]>s;m--)e[m]=e[m-1];e[m]=[a,r,s]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var s=Object.create(null);l.r(s);var i={};t=t||[null,a({}),a([]),a(a)];for(var n=2&r&&e;"object"==typeof n&&!~t.indexOf(n);n=a(n))Object.getOwnPropertyNames(n).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,l.d(s,i),s},l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};l.O.j=t=>0===e[t];var t=(t,a)=>{var r,s,i=a[0],n=a[1],o=a[2],c=0;if(i.some((t=>0!==e[t]))){for(r in n)l.o(n,r)&&(l.m[r]=n[r]);if(o)var m=o(l)}for(t&&t(a);c<i.length;c++)s=i[c],l.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return l.O(m)},a=self.webpackChunkreact_threejs=self.webpackChunkreact_threejs||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var i=l.O(void 0,[874,641,632,8,931,582,587,543,233,169,499],(()=>l(464)));i=l.O(i)})();